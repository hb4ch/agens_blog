# AgensGraph执行引擎概述

AgensGraph是一个属性图数据库系统，它围绕着postgres的一些基础能力产生出了一套可以对属性图进行增、删、改、查等操作的完整方法。对于AgensGraph的执行模块进行研究免不了需要对postgres系统的执行模块进行研究。所谓执行模块（Execution module）或执行器（Executor）的作用是对于用户查询请求进行解析、分析、重写、优化从而产生物理计划后，对这个计划进行实际的计算或其他内存或IO操作。

数据库系统的执行器的计算模式主要有pull-based和push-based两种。Postgres采用的是pull-based计算模式，也就是我们熟悉的迭代器模式。对于每个物理算子操作都需要抽象出open, close, next三个方法。其中open函数进行算子内初始化的作用，close为关闭相关资源的作用，next方法产生一条数据并返回其迭代器。抽象出这三个方法的好处是能够较为自由地进行算子间的组合使用，能够有强大的计算表达能力，并且实现较简单。但是缺点是，函数调用次数过多，每次函数调用可能需要调用函数指针，容易造成CPU执行不高效的问题。虽然迭代器模型有这这样那样的缺点，但是由于这样抽象出的物理算子适用面广，能够支持许多的关系计算操作，通用的数据库系统还是以使用pull-based计算模式实现执行器为主流的方法。postgres的执行模块大体也是遵照pull-based计算模式实现的。

AgensGraph的一个核心能力是可以使用Cypher语句进行属性图的DML、DQL操作。Cypher语句还可以和SQL混写，这是由于AgensGraph在物理计划生成前，先将无论是Cypher还是SQL语句解析为逻辑计划，而这个逻辑计划可以被转化成通用的AgensGraph的物理计划，并由执行器执行。从这些图查询请求生成的物理计划大部分是由传统的关系代数算子组成，还有一部分为图查询特有的物理算子。这些图查询所特有的物理算子从查询的等价性角度来讲也可以被转化为关系代数计算，但是效率可能偏低。AgensGraph为了提升查询的性能，实现了一系列属性图查询所特有的物理算子，如shortestPath等等。在属性图查询中，物理算子和逻辑算子的界限略有模糊，因为往往在图查询语句中就可以指定其中一些物理算子进行计算。比如看这个语句：...

